---
title: "Dashboard Refonte"
author: "Nicolas Kempf"
date: "18 décembre 2018"
output: flexdashboard::flex_dashboard
---

```{r setup, include=FALSE}
library(readxl) # Read Excel file
library(flexdashboard) # Widget for dashboard
library(dplyr)
library(DT) # Interactive table

load("../../Data/Tmp/qpv_stat_tmp.RData")
ind <- qpv_stat$indicateur_stat %>% 
  filter(idZonage == "QP971001")

table(ind$indicateur)

```

Territoire {data-orientation=rows}
=====================================  
    
Row
-------------------------------------

### Population

```{r}
valueBox(ind %>% 
           filter(domaine == "Territoire" & indicateur == "population" & type.indicateur == "freq_p") %>% 
           select(value), icon = "fa-pencil")
```

### Densité

```{r}
valueBox("300 hab/km²", icon = "fa-pencil")
```

### Superficie

```{r}
valueBox(ind %>% 
           filter(domaine == "Territoire " & categorie == "population" & indicateur == "population" & type.indicateur == "superficie")%>% 
           select(value), icon = "fa-pencil")
```

Row 
-------------------------------------
   
### Territoire

```{r}
df <- read_excel("Dashboard table example.xls",sheet = "Territoire")
datatable(df,rownames = FALSE, options = list(dom = 't'))
```   
    
### Population

```{r}
df <- read_excel("Dashboard table example.xls",sheet = "Population")
datatable(df,rownames = FALSE, options = list(dom = 't'))
```

Row 
-------------------------------------
   
### Pyramide des ages

```{r}
library("wpp2015") # Données de population
# library(tidyverse) # Transformation de données

#load data in wpp2015
data(popF)
data(popM)
data(popFprojMed)
data(popMprojMed)

#combine past and future female population
df0 <- popF %>% 
  left_join(popFprojMed) %>%
  mutate(gender = "female")

#combine past and future male population, add on female population
df1 <- popM %>% 
  left_join(popMprojMed) %>%
  mutate(gender = "male") %>%
  bind_rows(df0) %>%
  mutate(age = factor(age, levels = unique(age)))

#stack data for ggplot, filter World population and required years
df2 <- df1 %>%
  gather(key = year, value = pop, -country, -country_code, -age, -gender) %>%
  mutate(pop = pop/1e03) %>%
  filter(country == "World", year %in% c(1950, 2000, 2050, 2100))

#add extra rows and numeric age variable for geom_step used for 2100
df2 <- df2 %>% 
  mutate(ageno = as.numeric(age) - 0.5)

df2 <- df2 %>%
  bind_rows(df2 %>% filter(year==2100, age=="100+") %>% mutate(ageno = ageno + 1)) 



library("ggthemes") 
ggplot(data = df2, aes(x = age, y = pop, fill = year)) +
  #bars for all but 2100
  geom_bar(data = df2 %>% filter(gender == "female", year != 2100) %>% arrange(rev(year)),
           stat = "identity",
           position = "identity") +
  geom_bar(data = df2 %>% filter(gender == "male", year != 2100) %>% arrange(rev(year)),
           stat = "identity",
           position = "identity",
           mapping = aes(y = -pop)) +
  #steps for 2100
  geom_step(data =  df2 %>% filter(gender == "female", year == 2100), 
            aes(x = ageno), size = 1) +
  geom_step(data =  df2 %>% filter(gender == "male", year == 2100), 
            aes(x = ageno, y = -pop), size = 1) +
  coord_flip() +
  #extra style shazzaz
  scale_y_continuous(labels = abs, limits = c(-400, 400), breaks = seq(-400, 400, 100)) +
  geom_hline(yintercept = 0) +
  theme_economist(horizontal = FALSE) +
  scale_fill_economist() +
  labs(fill = "", x = "", y = "")
```   

### Composition des ménages

```{r}
df <- data.frame(var=c("a", "b", "c"), nums=c(1:3))
ggplot(df, aes(x=var, y=nums)) + geom_bar(stat = "identity") + coord_flip() 
```   


Revenu - Pauvreté {data-orientation=rows}
=====================================     
   
Row
-------------------------------------

### Niveau de vie moyen

```{r}
valueBox("15 000 €", icon = "fa-pencil")
```

### Taux de pauvreté

```{r}
valueBox("28 %", icon = "fa-pencil")
```

### Nombre de personnes sous le seuil de pauvreté

```{r}
valueBox("50 000", icon = "fa-pencil")
```

Row 
-------------------------------------
   
### Distribution du niveau de vie

```{r}
data(airquality)
airquality$Month <- factor(airquality$Month,
                           labels = c("May", "Jun", "Jul", "Aug", "Sep"))

ggplot(airquality, aes(x = Month, y = Ozone)) +
  geom_boxplot(colour = "black", fill = "#56B4E9") +
  scale_y_continuous(name = "Mean ozone in\nparts per billion",
                     breaks = seq(0, 175, 25),
                     limits=c(0, 175)) +
  scale_x_discrete(name = "Month") +
  theme(axis.line.x = element_line(size = 0.5, colour = "black"),
        axis.line.y = element_line(size = 0.5, colour = "black"),
        axis.line = element_line(size=1, colour = "black"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        plot.title=element_text(size = 20, family="xkcd-Regular"),
        text=element_text(size = 16, family="xkcd-Regular"),
        axis.text.x=element_text(colour="black", size = 12),
        axis.text.y=element_text(colour="black", size = 12))

```   
    
### Pauvreté

```{r}
df <- read_excel("Dashboard table example.xls",sheet = "Pauvrete")
datatable(df,rownames = FALSE, options = list(dom = 't'))
```

Row 
-------------------------------------
   
### Courbe de lorenz

```{r}
require(pacman)
pacman::p_load(reldist,gridExtra,tidyverse)

x <- c(1,2,3,10,15,15,30,50)
n <- length(x)
f <- (1:n)/n   # variable called F on wikipedia but variables shouldn't be called 'F' in R 
# since F abbreviates FALSE by default

Q <- cumsum(x)/sum(x)
f <- c(0,f)
Q <- c(0,Q)
lorenz <- data.frame(f,Q)

ggplot(lorenz,aes(x=f))+
  geom_line(aes(x=f,y=Q),color=I("blue")) +geom_point(aes(x=f,y=Q),color=I("blue"))  + geom_abline(intercept=0, slope=1) + labs(x="F\n(Cumulative portion of people,\narranged from lowest to highest income)", y = "Q\n(cumulative portion of income earned)", title="Economic Inequality", subtitle="Lorenz Curve")
```   
    
### Pauvreté selon l'âge et la composition du ménage

```{r}
df <- read_excel("Dashboard table example.xls",sheet = "Pauvrete2")
datatable(df,rownames = FALSE, options = list(dom = 't'))
```

Row 
-------------------------------------
   
### Composition du niveau de vie

```{r}
df <- data.frame(var=c("a", "b", "c"), nums=c(1:3))
ggplot(df, aes(x=var, y=nums)) + geom_bar(stat = "identity") + coord_flip()
```   
    
### A determiner

```{r}

```


Emploi {data-orientation=rows}
=====================================     
   
Row
-------------------------------------

### Taux d'emploi au sens du RP

```{r}
valueBox("25 %", icon = "fa-pencil")
```

### Taux de chômage au sens du RP

```{r}
valueBox("29 %", icon = "fa-pencil")
```

### Taux d'activité au sens du RP

```{r}
valueBox("75 %", icon = "fa-pencil")
```

Row
-------------------------------------

### Composition du niveau de vie

```{r}
df <- data.frame(var=c("a", "b", "c"), nums=c(1:3))
ggplot(df, aes(x=var, y=nums)) + geom_bar(stat = "identity") + coord_flip()
``` 

### Statistiques de l'emploi
```{r}
df <- read_excel("Dashboard table example.xls",sheet = "Emploi")
datatable(df,rownames = FALSE, options = list(dom = 't'))
```

Scolarisation {data-orientation=rows}
=====================================     
   
Row
-------------------------------------

### A determiner

```{r}
valueBox("25 %", icon = "fa-pencil")
```

### A determiner

```{r}
valueBox("29 %", icon = "fa-pencil")
```

### A determiner

```{r}
valueBox("75 %", icon = "fa-pencil")
```

Row
-------------------------------------

### A determiner

```{r}

``` 

### A determiner

```{r}

```

Logement {data-orientation=rows}
=====================================     
   
Row
-------------------------------------

### A determiner

```{r}
valueBox("25 %", icon = "fa-pencil")
```

### A determiner

```{r}
valueBox("29 %", icon = "fa-pencil")
```

### A determiner

```{r}
valueBox("75 %", icon = "fa-pencil")
```

Row
-------------------------------------

### A determiner

```{r}

``` 

### A determiner

```{r}

```




























